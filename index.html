<html>
<head>
    <script src="https://res.cdn.office.net/teams-js/2.0.0/js/MicrosoftTeams.min.js"></script>
    <style>
        .btn { 
            display: inline-block; 
            padding: 10px 20px; 
            background: #0078d4; 
            color: white; 
            text-decoration: none; 
            border-radius: 4px; 
            margin: 10px;
        }
        #debug { 
            background: #f3f2f1; 
            padding: 10px; 
            margin: 10px 0; 
            font-family: monospace; 
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1 id="training-title">Keepnet Training</h1>
    <p>Keepnet olarak senin iÃ§in bir eÄŸitim hazÄ±rladÄ±k.</p>
    
    <a id="training-button" href="#" class="btn">ðŸŽ¯ EÄŸitime Git</a>
    <a id="training-button2" href="#" class="btn">ðŸŽ¯ EÄŸitime Git 2</a>
    
    <div id="debug">Debug bilgisi yÃ¼kleniyor...</div>

    <script>
        let debugInfo = [];
        
        function log(message) {
            debugInfo.push(new Date().toLocaleTimeString() + ": " + message);
            document.getElementById('debug').innerHTML = debugInfo.join('<br>');
        }
        
        function updateButtons(trainingUrl) {
            log('ButonlarÄ± gÃ¼ncelleniyor: ' + trainingUrl);
            const button1 = document.getElementById('training-button');
            const button2 = document.getElementById('training-button2');
            
            if (button1 && button2) {
                button1.href = trainingUrl;
                button2.href = trainingUrl;
                
                // Teams'de window.open yerine href kullan
                button1.setAttribute('target', '_blank');
                button2.setAttribute('target', '_blank');
                
                log('Butonlar gÃ¼ncellendi!');
            } else {
                log('Butonlar bulunamadÄ±!');
            }
        }
        
        // URL parametrelerini dene (fallback)
        function tryUrlParams() {
            log('URL parametreleri deneniyor...');
            const urlParams = new URLSearchParams(window.location.search);
            const trainingUrl = urlParams.get('trainingurl');
            const title = urlParams.get('title');
            
            log('URL params - trainingUrl: ' + trainingUrl);
            log('URL params - title: ' + title);
            
            if (title) {
                document.getElementById('training-title').textContent = title;
            }
            if (trainingUrl) {
                updateButtons(trainingUrl);
            }
        }
        
        // Teams iÃ§inde mi kontrol et
        function isInTeams() {
            return window.parent !== window || window.location.ancestorOrigins?.length > 0;
        }
        
        log('Sayfa yÃ¼klendi. Teams iÃ§inde: ' + isInTeams());
        
        // Teams SDK deneyelim
        if (typeof microsoftTeams !== 'undefined') {
            log('Teams SDK bulundu, initialize ediliyor...');
            
            microsoftTeams.app.initialize().then(() => {
                log('Teams SDK initialize baÅŸarÄ±lÄ±');
                
                microsoftTeams.app.getContext().then((context) => {
                    log('Context alÄ±ndÄ±: ' + JSON.stringify(context, null, 2));
                    
                    // subEntityId kontrol et
                    if (context.page && context.page.subEntityId) {
                        log('subEntityId bulundu: ' + context.page.subEntityId);
                        try {
                            const params = JSON.parse(decodeURIComponent(context.page.subEntityId));
                            log('Parametreler parse edildi: ' + JSON.stringify(params));
                            
                            if (params.title) {
                                document.getElementById('training-title').textContent = params.title;
                                log('Title gÃ¼ncellendi: ' + params.title);
                            }
                            
                            if (params.trainingurl) {
                                updateButtons(params.trainingurl);
                            }
                        } catch (e) {
                            log('subEntityId parse hatasÄ±: ' + e.message);
                            tryUrlParams();
                        }
                    } else {
                        log('subEntityId bulunamadÄ±, URL params deneniyor');
                        tryUrlParams();
                    }
                }).catch(e => {
                    log('Context alma hatasÄ±: ' + e.message);
                    tryUrlParams();
                });
            }).catch(e => {
                log('Teams SDK initialize hatasÄ±: ' + e.message);
                tryUrlParams();
            });
        } else {
            log('Teams SDK bulunamadÄ±, URL params deneniyor');
            tryUrlParams();
        }
        
        // DOMContentLoaded ile de deneyelim
        document.addEventListener('DOMContentLoaded', function() {
            log('DOM yÃ¼klendi');
            // 2 saniye sonra tekrar dene
            setTimeout(() => {
                if (document.getElementById('training-button').href === window.location.href + '#') {
                    log('Butonlar hala gÃ¼ncel deÄŸil, tekrar deneniyor...');
                    tryUrlParams();
                }
            }, 2000);
        });
    </script>
</body>
</html>